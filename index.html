<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SMART IPTV PRO | Herber eDevelopment</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root {
    --theme-light:#66d8ff;
    --theme-moderate:#118599;
    --theme-dark:#0d3949;
    --bg-light:#313338;
    --bg-moderate:#2b2d31;
    --bg-dark:#1e1f22;
    --button:#444;
}

*{box-sizing:border-box}

body{
    margin:0;
    height:100vh;
    display:flex;
    background:#000;
    color:#fff;
    font-family:sans-serif;
    overflow:hidden;
}

/* SIDEBAR DRAWER */
.list-container {
    width: 380px;
    background: var(--bg-moderate);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 9999; /* সবার উপরে থাকবে */
    position: absolute;
    height: 100%;
    transform: translateX(-100%); /* ডিফল্ট ভাবে লুকানো */
}

body.sidebar-open .list-container {
    transform: translateX(0);
}

#settings_headline{
    padding:16px;
    background:linear-gradient(45deg,var(--theme-dark),var(--theme-moderate),var(--theme-light));
    font-weight:bold;
    display:flex;
    justify-content:space-between;
}

#current_head{
    padding:6px 16px;
    background:var(--bg-dark);
    font-size:13px;
    opacity:.7;
}

#search_bar{
    padding:10px;
    background:var(--bg-dark);
}

input,select,button{
    width:100%;
    padding:10px;
    border:none;
    background:var(--button);
    color:#fff;
    margin-bottom:6px;
}

button{
    cursor:pointer;
    background:var(--theme-moderate);
}

.settings-nav{
    list-style:none;
    padding:0;
    margin:0;
    overflow-y:auto;
    flex-grow:1;
}

.settings-nav li{
    padding:14px 20px;
    cursor:pointer;
    border-bottom:1px solid #000;
}

.settings-nav li:hover,
.settings-nav li.checked{
    background:var(--theme-moderate);
}

.player-area{
    width: 100vw;
    height: 100vh;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:center;
}

video{
    width:100%;
    height: 100%;
    object-fit: contain; /* ভিডিওর রেশিও ঠিক রাখবে */
}

.content-grid{
    padding:15px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
    gap:12px;
    overflow-y:auto;
}

.channel-button{
    background:var(--button);
    padding:12px;
    border-radius:8px;
    cursor:pointer;
    text-align:center;
}

.channel-button img{
    width:50px;
    height:50px;
    object-fit:contain;
}
</style>
</head>

<body>

<div class="list-container" id="sideBar">
    <div id="settings_headline">
        <span>SMART IPTV PRO</span>
        <span id="clock"></span>
    </div>

    <div id="current_head">// ALL CHANNELS</div>

    <div id="search_bar">
        <input type="text" id="searchInput" placeholder="Search Channels..." onkeyup="doSearch()">
    </div>

    <div style="padding:10px;background:var(--bg-dark)">
        <input type="text" id="playlistInput" placeholder="Add M3U Playlist URL">
        <button onclick="addPlaylist()">➕ Add Playlist</button>
        <select id="playlistSelect"></select>
        <button onclick="loadSelectedPlaylist()">▶ Load Playlist</button>
    </div>

    <ul class="settings-nav" id="categoryNav">
        <li class="checked" onclick="loadCategory('All',this)">All Channels</li>
        <li onclick="loadCategory('Favorites',this)">⭐ Favorites</li>
    </ul>
</div>

<div class="player-area" id="playerArea">
    <video id="mainVideo" playsinline></video>
</div>

<script>
const DEFAULT_M3U = 'https://raw.githubusercontent.com/sm-monirulislam/SM-Live-TV/refs/heads/main/Combined_Live_TV.m3u';

let database = [];
let currentList = [];
let currentUrl = "";
let playlists = JSON.parse(localStorage.getItem('herber_playlists')) || [{name:'Default Playlist',url:DEFAULT_M3U}];

initPlaylists();
loadPlaylist(DEFAULT_M3U);

function initPlaylists(){
    const sel=document.getElementById('playlistSelect');
    sel.innerHTML='';
    playlists.forEach(p=>{
        const o=document.createElement('option');
        o.value=p.url; o.text=p.name;
        sel.appendChild(o);
    });
}

async function loadPlaylist(url){
    try {
        const res = await fetch(url);
        const txt = await res.text();
        parseM3U(txt);
    } catch(e) { alert("Playlist load failed!"); }
}

function parseM3U(data){
    database=[];
    const lines=data.split('\n');
    let current=null;
    lines.forEach(l=>{
        if(l.startsWith('#EXTINF')){
            current={
                name:l.split(',')[1]||'Unknown',
                logo:l.match(/tvg-logo="([^"]+)"/)?.[1]||'',
                group:l.match(/group-title="([^"]+)"/)?.[1]||'Others'
            };
        }else if(l.startsWith('http')){
            current.url=l.trim();
            database.push(current);
        }
    });
    currentList = database;
    renderGrid(database);
}

function renderGrid(list){
    const nav = document.getElementById('categoryNav');
    // গ্রিড রেন্ডার করার জন্য এখানে বাড়তি UI এলিমেন্ট যোগ করা যেতে পারে।
    // বর্তমানে শুধু লিস্ট থেকে প্লে করার লজিক রাখা হয়েছে।
}

/* PLAYER LOGIC */
let hls = new Hls();
const v = document.getElementById('mainVideo');

function play(url){
    currentUrl = url;
    
    // ভিডিও এরিয়া ফুলস্ক্রিন করা
    requestFullScreen(document.documentElement);

    if(Hls.isSupported()){
        hls.destroy();
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED,()=>v.play());
    } else { v.src = url; v.play(); }

    // চ্যানেল সিলেক্ট করলে সাইডবার বন্ধ করা
    document.body.classList.remove('sidebar-open');
}

function requestFullScreen(element) {
    if (element.requestFullscreen) element.requestFullscreen();
    else if (element.webkitRequestFullscreen) element.webkitRequestFullscreen();
    else if (element.msRequestFullscreen) element.msRequestFullscreen();
}

/* SWIPE LOGIC */
let startX = 0, startY = 0;

document.addEventListener('touchstart', e => {
    startX = e.changedTouches[0].screenX;
    startY = e.changedTouches[0].screenY;
});

document.addEventListener('touchend', e => {
    let endX = e.changedTouches[0].screenX;
    let endY = e.changedTouches[0].screenY;
    let diffX = endX - startX;
    let diffY = startY - endY;

    // ১. বাম থেকে ডানে সোয়াইপ (বার বের করা) - স্ক্রিনের বাম পাশ থেকে টান দিলে
    if (diffX > 100 && startX < 80) {
        document.body.classList.add('sidebar-open');
    } 
    // ২. ডান থেকে বামে সোয়াইপ (বার ঢুকানো)
    else if (diffX < -100) {
        document.body.classList.remove('sidebar-open');
    }
    // ৩. উপরে/নিচে সোয়াইপ (চ্যানেল পরিবর্তন)
    if (Math.abs(diffY) > 100 && Math.abs(diffX) < 60) {
        changeChannel(diffY < 0 ? 1 : -1);
    }
});

function changeChannel(dir) {
    if(currentList.length === 0) return;
    let index = currentList.findIndex(ch => ch.url === currentUrl);
    index += dir;
    if (index >= currentList.length) index = 0;
    if (index < 0) index = currentList.length - 1;
    play(currentList[index].url);
}

// ক্যাটাগরি লোড ফাংশন (লিস্ট রেন্ডারিং এর জন্য)
function loadCategory(cat, el) {
    // এখানে আপনার ক্যাটাগরি ফিল্টার লজিক থাকবে
}

setInterval(()=>document.getElementById('clock').innerText=new Date().toLocaleTimeString(),1000);
</script>

</body>
</html>
